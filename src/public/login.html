<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Scratchpad</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="auth-container">
    <div class="auth-card">
      <h1>Scratchpad</h1>
      <p class="subtitle">Quick notes for university labs - auto-clears in 30 days</p>
      
      <form id="loginForm">
        <input 
          name="username" 
          placeholder="Username" 
          required 
          autocomplete="username"
          spellcheck="false"
        />
        <input 
          name="password" 
          type="password" 
          placeholder="Password" 
          required 
          autocomplete="current-password"
        />
        <button type="submit" id="loginBtn">
          <span>Login</span>
        </button>
      </form>
      
      <p>Don't have an account? <a href="/register.html">Create one</a></p>
      <div id="msg" class="msg" style="display: none;"></div>
    </div>
  </main>

  <script>
    const form = document.getElementById('loginForm');
    const msg = document.getElementById('msg');
    const loginBtn = document.getElementById('loginBtn');
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Show loading state
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<span>Signing in...</span>';
      form.classList.add('loading');
      msg.style.display = 'none';
      
      try {
        const res = await fetch('/api/login.php', {
          method: 'POST',
          body: new URLSearchParams(new FormData(form))
        });
        
        const data = await res.json();
        
        if (res.ok && data.success) {
          // Success - redirect to notes
          loginBtn.innerHTML = '<span>Success! Redirecting...</span>';
          setTimeout(() => {
            location.href = '/notes.php';
          }, 500);
        } else {
          // Error - show message
          msg.style.color = '#ef4444';
          msg.textContent = data.error || 'Login failed';
          msg.style.display = 'block';
          
          // Reset button
          loginBtn.disabled = false;
          loginBtn.innerHTML = '<span>Login</span>';
          form.classList.remove('loading');
        }
      } catch (error) {
        // Network error
        msg.style.color = '#ef4444';
        msg.textContent = 'Network error. Please try again.';
        msg.style.display = 'block';
        
        // Reset button
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<span>Login</span>';
        form.classList.remove('loading');
      }
    });
    
    // Auto-focus username field
    document.querySelector('input[name="username"]').focus();
  </script>
</body>
</html>
